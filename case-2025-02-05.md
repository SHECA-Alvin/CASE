## Incident Report

### Summary

SHECA为合作伙伴签发了新的中级根证书，并配置了新的证书产品。然而，在使用中级根 **Keymatic Secure Domain ECC CA G1** 签发 DV SSL 证书时，由于操作员失误，将该中级根下的 DV SSL 证书产品误引用了 OV  SSL证书模板且由于白名单未配置相关的产品编码导致**签发前linting**流程未生效，所以签发的证书中 **certificatePolicies** 扩展项包含 OV 证书的 OID，同时证书的 DN 中仅包含 **CN** 和 **C** 两个属性。

### Impact

以下三张证书格式存在错误，目前均已根据客户要求，吊销证书。

https://crt.sh/?id=16556132396

https://crt.sh/?id=16546315389

https://crt.sh/?id=16535669659

### Timeline

All times are UTC+8.

2025-01-05:

- **15:00** SHECA为合作伙伴签发新的定制中级根**Keymatic Secure Domain ECC CA G1**。

2024-01-24:

- **21:00** 新增DV SSL证书产品，CA系统操作员对新的中级根（**Keymatic Secure Domain ECC CA G1**）的DV SSL证书产品配置证书模板并刷新缓存使模板生效。

2024-02-05:

- **15:00** 订户申请签发ECC算法证书，SHECA共签发三张证书。

2024-02-07:

- **17:21**  SHECA的合规部门收到告警，告警显示由**Keymatic Secure Domain ECC CA G1** 签发的三张DV证书存在格式问题，告警来自**定时linting任务**，该定时任务会在每周五对所有在未吊销的证书执行一次linting，发现存在问题的证书会进行告警通知。
- **17:30**  合规部门通知业务部门停止使用**Keymatic Secure Domain ECC CA G1** 签发证书。
- **23:44**  SHECA 收到第三方邮件通知证书存在格式问题，经核实，与上述证书一致。

2024-02-10:

- **10:02** CA系统操作员检查发现，中级根**Keymatic Secure Domain ECC CA G1**关联的DV SSL证书产品被误配置为引用OV SSL证书模板。
- **10:10** CA系统操作员重新检查所有证书产品的配置，确认无其他证书产品模板存在类似问题。
- **10:40** CA系统操作员重新配置**Keymatic Secure Domain ECC CA G1**关联的证书产品模板为DV  SSL模板，并刷新缓存。
- **11:00** 排查**签发前linting**未执行的原因，SHECA严格依照BR的要求会在证书签发前对待签名的证书执行linting。
- **15:01** 排查到**签发前linting**未执行的原因是由于需要执行linting的产品编码白名单中未包含 **Keymatic Secure Domain ECC CA G1**关联的DV SSL证书产品编码导致的。



### Root Cause Analysis

**原因一**

SHECA 的 CA 系统操作员误操作，将 **Keymatic Secure Domain ECC CA G1** 关联的 DV  SSL证书产品的模板错误地引用为 OV SSL 证书的模板。

**原因二**

SHECA通过配置产品白名单的方式限定哪些证书产品需要执行**签发前linting**。然而，在此次新增产品后，未及时通知工程师将相关产品编码加入白名单中，从而导致**签发前linting** 校验失效，未能拦截本次错误签发。



### Lessons Learned

#### What went well

* SHECA对所有未吊销的证书执行linting定时任务，使得SHECA很快发现了该问题。

#### What didn't go well

* 证书模板的配置缺乏二次审核机制；
* 新增产品流程不规范。

#### Where we got lucky

* 不适用

### Action Items

| Action Item                                                  | Kind    | Due Date   |
| ------------------------------------------------------------ | ------- | ---------- |
| 规范新增产品流程，将添加linting白名单这一步骤加入到新增产品流程中 | Prevent | 2025-02-30 |
| 增加证书模板配置后的二次审核机制，由操作员配置完成后由审核员进行二次审核，审核员审核通过后模板才可生效 | Prevent | 2025-02-30 |

### Appendix

https://crt.sh/?id=16556132396

https://crt.sh/?id=16546315389

https://crt.sh/?id=16535669659
